{% load humanize %}
<div class="p-3 bg_scoundary_color mt-5">
    <h4 class="Tajawal-Bold">To Approve</h4>
    <hr>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                <th scope="col">#</th>
                <th scope="col">Transaction Category </th>
                <th scope="col">Date</th>
                <th scope="col">Amount</th>
                <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
               {% if to_approve %}
               {% for request in to_approve %}
               <tr>
                    <th scope="row">{{request.id}}</th>
                    <td>{{request.category}}</td>
                    <td>{{request.start_at}}</td>
                    <td>{{request.user_amount|floatformat:2|intcomma}}</td>
                    <td class="text-center text-md-end">
                    <button type="button" onclick="ap_approve({{request.id}})" data-bs-toggle="modal" data-bs-target="#approveModal" class="btn btn-success mb-2 mb-md-0">Approve</button>
                    <button type="button" onclick="ap_review({{request.id}})"  data-bs-toggle="modal" data-bs-target="#newRequest" class="btn btn-primary">Review</button>
                    </td>
                </tr>
               {% endfor %}
               {% else %}
               <tr>
                <td class="text-center" colspan="5">No transactions available</td>
               </tr>
               {% endif %}
               
            </tbody>
        </table>
     </div>
    <!-- Pagination-->
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            {% if to_approve.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page2={{to_approve.previous_page_number}}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            {% endif %}
            {% for object in to_approve.paginator.page_range %}
            <li class="page-item"><a class="page-link" href="?page2={{ forloop.counter }}">{{ forloop.counter }}</a></li>
            {% endfor %} 
            {% if to_approve.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page2={{to_approve.next_page_number}}" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
          {% endif %}
        </ul>
    </nav>
</div>

<script>
  function ap_approve(id)
  {
    $.ajax({
      url : "/request/approve/"+id, // create institution
      //type : "POST", // http method
      //data : formData, // data sent with the post request
      cache: false,
      contentType: false,
      processData: false,
      success : function(res) {
        re = $(res)
        $("#edit-approve-list-form #id_amount").replaceWith(re[0])
        $("#edit-approve-list-form #id_approved_list").replaceWith(re[1])
        $("#edit-approve-list-form #id_users").replaceWith(re[2])
        $("#edit-approve-list-form #request_id").val(id)
        users = $(re[2])
        approve = $(re[1])

        
        
        $.each(users.find("input:checkbox:not(:checked)"),function(key,value){
          if( $("#edit-approve-list-form #id_approved_list input[value="+value.value+"]").length){
            $("#edit-approve-list-form #id_approved_list input[value="+value.value+"]").parent().addClass('d-none')
          }

          $.each(approve.find("input:checked"),function(key,value){
          
            $("#edit-approve-list-form #id_approved_list input[value="+value.value+"]").prop('readonly',true)
          })
          
          
          
        })
        //console.log(users.find("input")[0])
        //console.log($("#edit-approve-list-form #id_approved_list input[value=5]").prop('disabled',true))
      },
      // handle a non-successful response
      error : function(xhr,errmsg,err) {
          console.log(err)
      }
  });
  }
  function ap_review(id)
  {
    $.ajax({
      url : "/request/review/"+id, // create institution
      //type : "POST", // http method
      //data : formData, // data sent with the post request
      cache: false,
      contentType: false,
      processData: false,
      success : function(res) {
          re = $(res)
          $("#id_category").replaceWith(re[0])
          $("#id_category").prop('disabled',true)
          $("#id_users").replaceWith(re[1])
          $("#id_users input").prop('disabled',true)
          $("#id_start_at").replaceWith(re[2])
          $("#id_start_at").prop('disabled',true)
          $("#id_amount").replaceWith(re[3])
          $("#id_amount").prop('disabled',true)
          $("#id_attachment").replaceWith(re[4])
          $("#id_attachment").prop('disabled',true)
          $("#id_note").replaceWith(re[5])
          $("#id_note").prop('disabled',true)
      },
      // handle a non-successful response
      error : function(xhr,errmsg,err) {
          console.log(err)
      }
  });
  }
</script>